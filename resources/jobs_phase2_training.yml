# Phase 2: Model Training
# Generates training data and trains the Ditto model

resources:
  jobs:
    # Training job - Generate training data and train Ditto model
    train_ditto_model:
      name: "[${bundle.target}] Entity Matching - Phase 2: Train Model"

      tasks:
        - task_key: train_and_register_model
          notebook_task:
            notebook_path: ../notebooks/02_train_ditto_model.py
            base_parameters:
              workspace_path: ${workspace.root_path}/files
              catalog_name: ${var.catalog_name}
              num_positive_pairs: "1000"
              num_negative_pairs: "1000"
              output_path: ${workspace.root_path}/training_data
              bundle_target: ${bundle.target}
          timeout_seconds: 14400  # 4 hours for full training pipeline

      max_concurrent_runs: 1
      email_notifications:
        on_success:
          - ${workspace.current_user.userName}@databricks.com
        on_failure:
          - ${workspace.current_user.userName}@databricks.com
      tags:
        project: entity_matching
        environment: ${bundle.target}
        phase: "2"
        step: model_training
